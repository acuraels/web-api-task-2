# üìù TODO API + WebSocket + Background Task

### –£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç ‚Ññ2 –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É ¬´–û—Å–Ω–æ–≤—ã Web API¬ª

**–ê–≤—Ç–æ—Ä:** –£—Å—Ç–∏–Ω–æ–≤ –î–∞–Ω–∏–∏–ª –ù–∏–∫–æ–ª–∞–µ–≤–∏—á, –†–ò-330948

---

## üìå –û–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–µ—Ä–≤–µ—Ä–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ **FastAPI**, —Ä–µ–∞–ª–∏–∑—É—é—â–µ–µ:

- –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π **REST API** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–º –∑–∞–¥–∞—á (TODO-list)
- **WebSocket-–∫–∞–Ω–∞–ª** –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞–º –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–§–æ–Ω–æ–≤—É—é –∑–∞–¥–∞—á—É**, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ —á–µ—Ä–µ–∑ `httpx` –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∏—Ö –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –ë–î** —á–µ—Ä–µ–∑ `SQLAlchemy + aiosqlite`
- –ù–µ–±–æ–ª—å—à–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã: **CLI-–∫–ª–∏–µ–Ω—Ç –Ω–∞ Python** (`client.py`) –∏ –ø—Ä–æ—Å—Ç–∞—è **HTML-—Å—Ç—Ä–∞–Ω–∏—Ü–∞** (`cors_test.html`) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ CORS –∏ WebSocket

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –≤ —Ä–∞–º–∫–∞—Ö —É—á–µ–±–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –±–∞–∑–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è backend-—Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ FastAPI.

---

## üöÄ –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **FastAPI** ‚Äî backend + OpenAPI-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **SQLite** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—á–µ—Ä–µ–∑ async SQLAlchemy)
- **SQLAlchemy (async)** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –ë–î
- **httpx** ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ HTTP-–∑–∞–ø—Ä–æ—Å—ã –∫ –≤–Ω–µ—à–Ω–µ–º—É API
- **WebSocket** ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **Pydantic** ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö
- **Uvicorn** ‚Äî ASGI-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
practice_2_todo/
‚îÇ‚îÄ‚îÄ main.py          # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ FastAPI (REST + WebSocket + Background)
‚îÇ‚îÄ‚îÄ client.py        # Python WebSocket-–∫–ª–∏–µ–Ω—Ç –¥–ª—è /ws/tasks
‚îÇ‚îÄ‚îÄ cors_test.html   # HTML-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è —Ç–µ—Å—Ç–∞ CORS + REST + WebSocket
‚îÇ‚îÄ‚îÄ requirements.txt # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ‚îÄ‚îÄ README.md        # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ‚îÄ‚îÄ .gitignore
‚îÇ‚îÄ‚îÄ todo.db          # –§–∞–π–ª SQLite-–±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è Git)
‚îî‚îÄ‚îÄ .venv/           # –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è Git)
```

---

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ backend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
python -m venv .venv
# Linux / macOS
source .venv/bin/activate
# Windows PowerShell
. .\.venv\Scripts\Activate.ps1
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install -r requirements.txt
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

```bash
uvicorn main:app --reload
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ backend –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:

- Swagger UI: **<http://127.0.0.1:8000/docs>**
- OpenAPI JSON: **<http://127.0.0.1:8000/openapi.json>**

---

## üì° –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### üîπ REST API (`/tasks`)

CRUD-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–ø–∏—Å–∫–æ–º –∑–∞–¥–∞—á:

- `GET /tasks` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
- `GET /tasks/{id}` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á—É –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É
- `POST /tasks` ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É
- `PATCH /tasks/{id}` ‚Äî —á–∞—Å—Ç–∏—á–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É
- `DELETE /tasks/{id}` ‚Äî —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –ë–î SQLite** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **SQLAlchemy AsyncSession**.

### üîπ Background Task

- `POST /task-generator/run` ‚Äî **—Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏**  
  –ü—Ä–∏ –≤—ã–∑–æ–≤–µ —ç—Ç–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ —Å–µ—Ä–≤–µ—Ä:
  1. –î–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –≤–Ω–µ—à–Ω–µ–º—É API `https://jsonplaceholder.typicode.com/todos/{id}` —á–µ—Ä–µ–∑ `httpx`
  2. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –º–æ–¥–µ–ª—å –∑–∞–¥–∞—á–∏
  3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
  4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º WebSocket-–∫–ª–∏–µ–Ω—Ç–∞–º

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ñ–æ–Ω–æ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å:

- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ (—Ä–∞–∑ –≤ N —Å–µ–∫—É–Ω–¥) –∑–∞–±–∏—Ä–∞–µ—Ç –∑–∞–¥–∞—á—É —Å —Ç–æ–≥–æ –∂–µ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ—ë –≤ –ë–î
- –û–ø–æ–≤–µ—â–∞–µ—Ç –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö WebSocket-–ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤

### üîπ WebSocket

- `GET /ws/tasks` ‚Äî WebSocket-–∫–∞–Ω–∞–ª –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å–æ–±—ã—Ç–∏—è—Ö —Å –∑–∞–¥–∞—á–∞–º–∏.

–°–µ—Ä–≤–µ—Ä —Ä–∞—Å—Å—ã–ª–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –ø—Ä–∏:

- —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏ (`event: "created"`)
- –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ (`event: "updated"`)
- —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ (`event: "deleted"`)
- –∏–º–ø–æ—Ä—Ç–µ –∑–∞–¥–∞—á–∏ –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ API (`event: "created_external"`)

–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è:

```json
{
  "event": "created",
  "task_id": 13,
  "task": {
    "id": 13,
    "title": "–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞",
    "description": "–°–æ–∑–¥–∞–Ω–æ —á–µ—Ä–µ–∑ REST API",
    "completed": false
  }
}
```

---

## üíª –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã

### 1. Python WebSocket-–∫–ª–∏–µ–Ω—Ç (`client.py`)

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ `ws://127.0.0.1:8000/ws/tasks` –∏ –≤—ã–≤–æ–¥–∏—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –≤ –∫–æ–Ω—Å–æ–ª—å.

–ó–∞–ø—É—Å–∫:

```bash
# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—â—ë –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ)
. .\.venv\Scripts\Activate.ps1  # Windows PowerShell
# –∏–ª–∏
source .venv/bin/activate          # Linux / macOS

# –ó–∞–ø—É—Å—Ç–∏—Ç—å backend –≤ –æ–¥–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
uvicorn main:app --reload

# –í–æ –≤—Ç–æ—Ä–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å WebSocket-–∫–ª–∏–µ–Ω—Ç
python client.py
```

–î–∞–ª–µ–µ –º–æ–∂–Ω–æ:

- —Å–æ–∑–¥–∞–≤–∞—Ç—å / –æ–±–Ω–æ–≤–ª—è—Ç—å / —É–¥–∞–ª—è—Ç—å –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ Swagger (`/docs`)
- –≤—ã–∑—ã–≤–∞—Ç—å `POST /task-generator/run`

–í—Å–µ —Å–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `client.py`.

### 2. HTML-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è —Ç–µ—Å—Ç–∞ CORS –∏ WebSocket (`cors_test.html`)

–§–∞–π–ª `cors_test.html` —Ä–µ–∞–ª–∏–∑—É–µ—Ç:

- –ö–Ω–æ–ø–∫—É **¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–¥–∞—á–∏¬ª** ‚Äî –∑–∞–ø—Ä–æ—Å `GET /tasks`
- –§–æ—Ä–º—É **—Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏** ‚Äî –∑–∞–ø—Ä–æ—Å `POST /tasks`
- –ü—Ä–∞–≤—É—é –ø–∞–Ω–µ–ª—å –ª–æ–≥–æ–≤, –∫—É–¥–∞ –ø–∞–¥–∞—é—Ç –≤—Å–µ WebSocket-—Å–æ–±—ã—Ç–∏—è

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:

- `fetch` –¥–ª—è REST-–∑–∞–ø—Ä–æ—Å–æ–≤ –∫ `http://127.0.0.1:8000`
- `WebSocket` –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ `ws://127.0.0.1:8000/ws/tasks`

–ó–∞–ø—É—Å–∫:

1. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω (`uvicorn main:app --reload`)
2. –û—Ç–∫—Ä—ã—Ç—å `cors_test.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –ø–æ —Ñ–∞–π–ª—É –∏–ª–∏ `Ctrl+O` ‚Üí –≤—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª)

–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å—Ä–∞–∑—É –ø–æ–¥–≥—Ä—É–∑—è—Ç—Å—è –∑–∞–¥–∞—á–∏ –∏ –Ω–∞—á–Ω—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å–æ–±—ã—Ç–∏—è WebSocket.

---

## üìò –ü—Ä–∏–º–µ—Ä –º–æ–¥–µ–ª–∏ –∑–∞–¥–∞—á–∏

```json
{
  "id": 1,
  "title": "Buy milk",
  "description": "2 liters",
  "completed": false
}
```

---

## üéØ –¶–µ–ª–∏ —Ä–∞–±–æ—Ç—ã

- –ù–∞—É—á–∏—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **FastAPI** –≤ —Å–≤—è–∑–∫–µ —Å **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ë–î**
- –û—Å–≤–æ–∏—Ç—å –±–∞–∑–æ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è **REST API** –∏ —Ä–∞–±–æ—Ç—É —Å –º–æ–¥–µ–ª—è–º–∏ **Pydantic**
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **WebSocket-–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é** –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ü–æ–Ω—è—Ç—å –ø–æ–¥—Ö–æ–¥ –∫ —Å–æ–∑–¥–∞–Ω–∏—é **—Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á** –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ HTTP-—Å–µ—Ä–≤–∏—Å–∞–º–∏
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –∫–ª–∏–µ–Ω—Ç—ã (CLI –∏ HTML) –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã backend-—Å–µ—Ä–≤–∏—Å–∞
